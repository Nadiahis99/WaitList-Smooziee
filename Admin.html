<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Smooziee â€“ Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù†</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --primary: #7b2cbf;
      --primary-light: #9b59b6;
      --primary-glow: rgba(123,44,191,0.15);
      --accent: #e91e8c;
      --bg: #0d0d14;
      --surface: #13131f;
      --surface2: #1a1a2e;
      --border: rgba(123,44,191,0.2);
      --text: #f0eaf8;
      --muted: #8a7a9b;
      --green: #2ecc71;
      --red: #e74c3c;
      --green-bg: rgba(46,204,113,0.1);
      --red-bg: rgba(231,76,60,0.1);
    }
    html { scroll-behavior: smooth; }
    body {
      font-family: 'Tajawal', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      direction: rtl;
    }

    /* Login */
    #loginScreen {
      position: fixed; inset: 0;
      display: flex; align-items: center; justify-content: center;
      background: var(--bg);
      z-index: 9999;
      transition: opacity 0.4s;
    }
    .login-box {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 50px 40px;
      width: 100%; max-width: 420px;
      text-align: center;
      box-shadow: 0 20px 60px rgba(0,0,0,0.5);
    }
    .login-logo { font-size: 42px; margin-bottom: 10px; }
    .login-box h1 { font-size: 28px; font-weight: 800; color: var(--text); margin-bottom: 5px; }
    .login-box p { color: var(--muted); font-size: 14px; margin-bottom: 30px; }
    .login-box input {
      width: 100%; padding: 14px 18px;
      background: var(--bg); border: 1px solid var(--border);
      border-radius: 12px; color: var(--text); font-size: 15px;
      font-family: 'Tajawal', sans-serif; text-align: center;
      margin-bottom: 15px; transition: border-color 0.3s;
      outline: none; letter-spacing: 4px;
    }
    .login-box input:focus { border-color: var(--primary); }
    .login-box input::placeholder { letter-spacing: normal; color: var(--muted); }
    .login-btn {
      width: 100%; padding: 14px;
      background: linear-gradient(135deg, var(--primary-light), var(--primary));
      color: white; border: none; border-radius: 12px;
      font-size: 17px; font-weight: 700; font-family: 'Tajawal', sans-serif;
      cursor: pointer; transition: transform 0.2s, box-shadow 0.2s;
    }
    .login-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 20px var(--primary-glow); }
    .login-error { color: var(--red); font-size: 13px; margin-top: 10px; min-height: 18px; }

    /* App */
    #app { display: none; }

    /* Sidebar */
    .sidebar {
      position: fixed; right: 0; top: 0; bottom: 0;
      width: 260px; background: var(--surface);
      border-left: 1px solid var(--border);
      display: flex; flex-direction: column;
      padding: 30px 20px; gap: 8px;
      z-index: 100;
    }
    .sidebar-logo {
      text-align: center; padding: 10px 0 25px;
      border-bottom: 1px solid var(--border); margin-bottom: 15px;
    }
    .sidebar-logo span { font-size: 22px; font-weight: 800; color: var(--text); }
    .sidebar-logo small { display: block; color: var(--muted); font-size: 12px; margin-top: 3px; }
    .nav-btn {
      display: flex; align-items: center; gap: 10px;
      padding: 12px 16px; border-radius: 12px;
      background: none; border: none; color: var(--muted);
      font-family: 'Tajawal', sans-serif; font-size: 15px;
      cursor: pointer; transition: all 0.2s; text-align: right; width: 100%;
    }
    .nav-btn:hover { background: var(--primary-glow); color: var(--text); }
    .nav-btn.active { background: var(--primary-glow); color: var(--primary-light); font-weight: 700; }
    .sidebar-bottom { margin-top: auto; }

    /* Main */
    .main { margin-right: 260px; padding: 30px; min-height: 100vh; }
    .page-header {
      display: flex; align-items: center; justify-content: space-between;
      margin-bottom: 30px;
    }
    .page-header h2 { font-size: 26px; font-weight: 800; }
    .page-header .sub { color: var(--muted); font-size: 14px; margin-top: 3px; }

    /* Stats */
    .stats-grid {
      display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 16px; margin-bottom: 30px;
    }
    .stat-card { background: var(--surface); border: 1px solid var(--border); border-radius: 16px; padding: 20px; }
    .stat-card .label { color: var(--muted); font-size: 13px; margin-bottom: 8px; }
    .stat-card .value { font-size: 32px; font-weight: 800; }
    .stat-card.green .value { color: var(--green); }
    .stat-card.red .value { color: var(--red); }
    .stat-card.purple .value { color: var(--primary-light); }

    /* Toggle */
    .toggle-card {
      background: var(--surface); border: 1px solid var(--border);
      border-radius: 16px; padding: 24px 28px;
      display: flex; align-items: center; justify-content: space-between;
      margin-bottom: 30px; gap: 20px; flex-wrap: wrap;
    }
    .toggle-info h3 { font-size: 18px; font-weight: 700; margin-bottom: 5px; }
    .toggle-info p { color: var(--muted); font-size: 13px; }
    .status-badge {
      display: inline-flex; align-items: center; gap: 6px;
      padding: 5px 14px; border-radius: 20px; font-size: 13px; font-weight: 700;
    }
    .status-badge.open { background: var(--green-bg); color: var(--green); border: 1px solid rgba(46,204,113,0.3); }
    .status-badge.closed { background: var(--red-bg); color: var(--red); border: 1px solid rgba(231,76,60,0.3); }
    .toggle-actions { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
    .btn {
      padding: 10px 22px; border-radius: 10px; border: none;
      font-family: 'Tajawal', sans-serif; font-size: 14px; font-weight: 700;
      cursor: pointer; transition: all 0.2s;
    }
    .btn-open { background: var(--green-bg); color: var(--green); border: 1px solid rgba(46,204,113,0.3); }
    .btn-open:hover { background: var(--green); color: white; }
    .btn-close { background: var(--red-bg); color: var(--red); border: 1px solid rgba(231,76,60,0.3); }
    .btn-close:hover { background: var(--red); color: white; }

    /* Table */
    .table-header {
      display: flex; align-items: center; justify-content: space-between;
      margin-bottom: 15px; flex-wrap: wrap; gap: 10px;
    }
    .tab-group { display: flex; gap: 8px; flex-wrap: wrap; }
    .tab-btn {
      padding: 8px 20px; border-radius: 10px; border: 1px solid var(--border);
      background: none; color: var(--muted); font-family: 'Tajawal', sans-serif;
      font-size: 14px; cursor: pointer; transition: all 0.2s;
    }
    .tab-btn.active { background: var(--primary-glow); color: var(--primary-light); border-color: var(--primary); }
    .search-box {
      padding: 9px 16px; background: var(--surface); border: 1px solid var(--border);
      border-radius: 10px; color: var(--text); font-family: 'Tajawal', sans-serif;
      font-size: 14px; outline: none; width: 220px; text-align: right;
    }
    .search-box:focus { border-color: var(--primary); }
    .table-wrap {
      background: var(--surface); border: 1px solid var(--border);
      border-radius: 16px; overflow: auto;
    }
    table { width: 100%; border-collapse: collapse; min-width: 700px; }
    thead tr { background: var(--surface2); }
    th {
      padding: 14px 16px; text-align: right; font-size: 13px;
      color: var(--muted); font-weight: 600; border-bottom: 1px solid var(--border);
      white-space: nowrap;
    }
    td {
      padding: 13px 16px; font-size: 14px;
      border-bottom: 1px solid rgba(123,44,191,0.07);
      vertical-align: middle;
    }
    tr:last-child td { border-bottom: none; }
    tr:hover td { background: var(--primary-glow); }
    .badge {
      display: inline-flex; align-items: center; gap: 4px;
      padding: 3px 10px; border-radius: 20px; font-size: 12px; font-weight: 700;
    }
    .badge-accepted { background: var(--green-bg); color: var(--green); }
    .badge-rejected { background: var(--red-bg); color: var(--red); }
    .empty-state { text-align: center; padding: 60px 20px; color: var(--muted); }
    .empty-state .icon { font-size: 48px; margin-bottom: 12px; }

    /* Pagination */
    .pagination { display: flex; gap: 8px; justify-content: center; margin-top: 20px; flex-wrap: wrap; }
    .page-btn {
      width: 36px; height: 36px; border-radius: 8px; border: 1px solid var(--border);
      background: var(--surface); color: var(--muted); font-family: 'Tajawal', sans-serif;
      cursor: pointer; transition: all 0.2s; font-size: 14px;
    }
    .page-btn:hover, .page-btn.active { background: var(--primary); color: white; border-color: var(--primary); }

    /* Toast */
    .toast {
      position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%) translateY(100px);
      padding: 12px 24px; border-radius: 12px; font-size: 15px; font-weight: 600;
      z-index: 9999; transition: transform 0.35s cubic-bezier(.175,.885,.32,1.275);
      min-width: 250px; text-align: center;
    }
    .toast.show { transform: translateX(-50%) translateY(0); }
    .toast.success { background: var(--green); color: white; }
    .toast.error { background: var(--red); color: white; }
    .toast.info { background: var(--primary); color: white; }

    @media (max-width: 768px) {
      .sidebar { display: none; }
      .main { margin-right: 0; padding: 20px 15px; }
    }
  </style>
</head>
<body>

<!-- Login -->
<div id="loginScreen">
  <div class="login-box">
    <div class="login-logo">ğŸ”</div>
    <h1>Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù†</h1>
    <p>Smooziee Waitlist Dashboard</p>
    <input type="password" id="adminPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" autocomplete="off" />
    <button class="login-btn" onclick="doLogin()">Ø¯Ø®ÙˆÙ„</button>
    <div class="login-error" id="loginError"></div>
  </div>
</div>

<!-- App -->
<div id="app">
  <aside class="sidebar">
    <div class="sidebar-logo">
      <span>ğŸŒ¸ Smooziee</span>
      <small>Admin Dashboard</small>
    </div>
    <button class="nav-btn active" onclick="showPage('dashboard')" id="nav-dashboard">
      <span>ğŸ“Š</span> Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
    </button>
    <button class="nav-btn" onclick="showPage('users')" id="nav-users">
      <span>ğŸ‘¥</span> Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ†
    </button>
    <button class="nav-btn" onclick="window.location.href='index.html'" style="color:#e91e8c;">
  <span>ğŸŒ¸</span> Ø§Ù„ÙˆÙŠØªÙ„ÙŠØ³Øª
</button>
    <div class="sidebar-bottom">
      <button class="nav-btn" onclick="doLogout()" style="color:var(--red);">
        <span>ğŸšª</span> Ø®Ø±ÙˆØ¬
      </button>
    </div>
  </aside>

  <main class="main">

    <!-- Dashboard -->
    <div id="page-dashboard">
      <div class="page-header">
        <div>
          <h2>ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</h2>
          <div class="sub">Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø¹Ù„Ù‰ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</div>
        </div>
        <button class="btn" style="background:var(--primary-glow);color:var(--primary-light);border:1px solid var(--primary);" onclick="loadAll()">
          ğŸ”„ ØªØ­Ø¯ÙŠØ«
        </button>
      </div>
      <div class="stats-grid">
        <div class="stat-card purple">
          <div class="label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§Øª</div>
          <div class="value" id="stat-total">â€”</div>
        </div>
        <div class="stat-card green">
          <div class="label">Ù…Ù‚Ø¨ÙˆÙ„ÙˆÙ† âœ…</div>
          <div class="value" id="stat-accepted">â€”</div>
        </div>
        <div class="stat-card red">
          <div class="label">Ù…Ø±ÙÙˆØ¶ÙˆÙ† âŒ</div>
          <div class="value" id="stat-rejected">â€”</div>
        </div>
        <div class="stat-card">
          <div class="label">Ù†Ø³Ø¨Ø© Ø§Ù„Ù‚Ø¨ÙˆÙ„</div>
          <div class="value" id="stat-rate" style="color:var(--accent);">â€”</div>
        </div>
      </div>
      <div class="toggle-card">
        <div class="toggle-info">
          <h3>Ø­Ø§Ù„Ø© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</h3>
          <p>ØªØ­ÙƒÙ…ÙŠ ÙÙŠ ÙØªØ­ ÙˆØ¥ØºÙ„Ø§Ù‚ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø¬Ø¯Ø¯</p>
        </div>
        <div class="toggle-actions">
          <span class="status-badge closed" id="waitlistStatusBadge">â— Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„</span>
          <button class="btn btn-open" onclick="setWaitlistStatus(true)">ğŸ”“ ÙØªØ­</button>
          <button class="btn btn-close" onclick="setWaitlistStatus(false)">ğŸ”’ Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
      </div>
    </div>

    <!-- Users -->
    <div id="page-users" style="display:none;">
      <div class="page-header">
        <div>
          <h2>ğŸ‘¥ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ†</h2>
          <div class="sub">Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ†</div>
        </div>
        <input class="search-box" type="text" id="searchInput" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ Ø£Ùˆ Ø§Ù„Ù‡Ø§ØªÙ..." oninput="renderTable()" />
      </div>
      <div class="table-header">
        <div class="tab-group">
          <button class="tab-btn active" id="tab-all" onclick="switchTab('all')">Ø§Ù„ÙƒÙ„</button>
          <button class="tab-btn" id="tab-accepted" onclick="switchTab('accepted')">Ù…Ù‚Ø¨ÙˆÙ„ÙˆÙ† âœ…</button>
          <button class="tab-btn" id="tab-rejected" onclick="switchTab('rejected')">Ù…Ø±ÙÙˆØ¶ÙˆÙ† âŒ</button>
        </div>
      </div>
      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th>#</th>
              <th>Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„</th>
              <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
              <th>Ù†ÙˆØ¹ Ø§Ù„Ø´Ø¹Ø±</th>
              <th>Ø§Ù„ÙØ±Ø´Ø© Ù…Ù‡Ù…Ø©ØŸ</th>
              <th>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…ØªÙˆÙ‚Ø¹</th>
              <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
              <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
            </tr>
          </thead>
          <tbody id="tableBody">
            <tr><td colspan="8" style="text-align:center;padding:40px;color:var(--muted);">â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</td></tr>
          </tbody>
        </table>
      </div>
      <div class="pagination" id="pagination"></div>
    </div>

  </main>
</div>

<div class="toast" id="toast"></div>

<!-- Firebase Compat SDK - ÙŠØ´ØªØºÙ„ Ù„ÙˆÙƒØ§Ù„ Ø¨Ø¯ÙˆÙ† Ù…Ø´Ø§ÙƒÙ„ -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

<script>
  // Firebase Config - WaitList Smooziee
  const firebaseConfig = {
    apiKey: "AIzaSyDiVI7kJ8mbXbK3doNDTc8hiilkHnJUFSY",
    authDomain: "waitlist-smooziee.firebaseapp.com",
    projectId: "waitlist-smooziee",
    storageBucket: "waitlist-smooziee.firebasestorage.app",
    messagingSenderId: "362626440005",
    appId: "1:362626440005:web:720c58b9e60782f6eafc2c",
    measurementId: "G-LBHJYBXS4M"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // ===== ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ø£Ø¯Ù…Ù† â€“ ØºÙŠÙ‘Ø±ÙŠÙ‡Ø§! =====
  const ADMIN_PASSWORD = "smooziee2025";

  let allUsers = [];
  let currentTab = 'all';
  let currentPage = 1;
  const PER_PAGE = 15;

  // ===== Login =====
  function doLogin() {
    const pw = document.getElementById('adminPassword').value;
    if (pw === ADMIN_PASSWORD) {
      const screen = document.getElementById('loginScreen');
      screen.style.opacity = '0';
      setTimeout(() => {
        screen.style.display = 'none';
        document.getElementById('app').style.display = 'block';
        loadAll();
      }, 400);
    } else {
      document.getElementById('loginError').textContent = 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙ„Ø· âŒ';
      document.getElementById('adminPassword').value = '';
    }
  }

  document.getElementById('adminPassword').addEventListener('keydown', function(e) {
    if (e.key === 'Enter') doLogin();
  });

  function doLogout() { location.reload(); }

  // ===== Load Data =====
  async function loadAll() {
    try {
      const [accSnap, rejSnap] = await Promise.all([
        db.collection("accepted_users").orderBy("submittedAt", "desc").get(),
        db.collection("rejected_users").orderBy("submittedAt", "desc").get()
      ]);

      const accepted = accSnap.docs.map(d => ({ id: d.id, ...d.data(), _col: 'accepted' }));
      const rejected = rejSnap.docs.map(d => ({ id: d.id, ...d.data(), _col: 'rejected' }));

      allUsers = [...accepted, ...rejected].sort((a, b) =>
        (b.submittedAt?.seconds || 0) - (a.submittedAt?.seconds || 0)
      );

      const total = accepted.length + rejected.length;
      document.getElementById('stat-total').textContent = total;
      document.getElementById('stat-accepted').textContent = accepted.length;
      document.getElementById('stat-rejected').textContent = rejected.length;
      document.getElementById('stat-rate').textContent = total > 0
        ? Math.round((accepted.length / total) * 100) + '%' : 'â€”';

      renderTable();
      loadWaitlistStatus();
      showToast('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª âœ…', 'success');
    } catch (err) {
      console.error(err);
      showToast('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª âŒ', 'error');
    }
  }

  // ===== Waitlist Status =====
  async function loadWaitlistStatus() {
    try {
      const snap = await db.collection("settings").doc("waitlist").get();
      updateStatusBadge(!snap.exists || snap.data().isOpen !== false);
    } catch (e) { console.error(e); }
  }

  async function setWaitlistStatus(isOpen) {
    try {
      await db.collection("settings").doc("waitlist").set({ isOpen });
      updateStatusBadge(isOpen);
      showToast(isOpen ? 'âœ… ØªÙ… ÙØªØ­ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±' : 'ğŸ”’ ØªÙ… Ø¥ØºÙ„Ø§Ù‚ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±', 'info');
    } catch (e) {
      showToast('Ø®Ø·Ø£ ÙÙŠ ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø© âŒ', 'error');
    }
  }

  function updateStatusBadge(isOpen) {
    const badge = document.getElementById('waitlistStatusBadge');
    badge.textContent = isOpen ? 'â— Ù…ÙØªÙˆØ­Ø©' : 'â— Ù…ØºÙ„Ù‚Ø©';
    badge.className = 'status-badge ' + (isOpen ? 'open' : 'closed');
  }

  // ===== Table =====
  function renderTable() {
    const search = (document.getElementById('searchInput')?.value || '').toLowerCase();
    let data = allUsers;

    if (currentTab === 'accepted') data = data.filter(u => u._col === 'accepted');
    if (currentTab === 'rejected') data = data.filter(u => u._col === 'rejected');
    if (search) data = data.filter(u =>
      (u.email || '').toLowerCase().includes(search) ||
      (u.phone || '').includes(search)
    );

    const totalPages = Math.ceil(data.length / PER_PAGE) || 1;
    currentPage = Math.min(currentPage, totalPages);
    const slice = data.slice((currentPage - 1) * PER_PAGE, currentPage * PER_PAGE);

    const tbody = document.getElementById('tableBody');
    if (slice.length === 0) {
      tbody.innerHTML = `<tr><td colspan="8"><div class="empty-state"><div class="icon">ğŸ”</div><div>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</div></div></td></tr>`;
    } else {
      tbody.innerHTML = slice.map((u, i) => `
        <tr>
          <td style="color:var(--muted)">${(currentPage - 1) * PER_PAGE + i + 1}</td>
          <td>${u.email || 'â€”'}</td>
          <td dir="ltr">${u.phone || 'â€”'}</td>
          <td>${u.hairType || 'â€”'}</td>
          <td>${u.brushImportance || 'â€”'}</td>
          <td>${u.priceGuess || 'â€”'} Ø¬Ù†ÙŠÙ‡</td>
          <td>
            <span class="badge ${u._col === 'accepted' ? 'badge-accepted' : 'badge-rejected'}">
              ${u._col === 'accepted' ? 'âœ… Ù…Ù‚Ø¨ÙˆÙ„' : 'âŒ Ù…Ø±ÙÙˆØ¶'}
            </span>
          </td>
          <td style="color:var(--muted);font-size:12px;">${formatDate(u.submittedAt)}</td>
        </tr>`).join('');
    }

    const pag = document.getElementById('pagination');
    pag.innerHTML = '';
    for (let p = 1; p <= totalPages; p++) {
      const btn = document.createElement('button');
      btn.className = 'page-btn' + (p === currentPage ? ' active' : '');
      btn.textContent = p;
      btn.onclick = () => { currentPage = p; renderTable(); };
      pag.appendChild(btn);
    }
  }

  function formatDate(ts) {
    if (!ts?.seconds) return 'â€”';
    return new Date(ts.seconds * 1000).toLocaleDateString('ar-EG', {
      day: '2-digit', month: '2-digit', year: 'numeric',
      hour: '2-digit', minute: '2-digit'
    });
  }

  function showPage(page) {
    document.getElementById('page-dashboard').style.display = page === 'dashboard' ? 'block' : 'none';
    document.getElementById('page-users').style.display = page === 'users' ? 'block' : 'none';
    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
    document.getElementById('nav-' + page)?.classList.add('active');
    if (page === 'users') renderTable();
  }

  function switchTab(tab) {
    currentTab = tab;
    currentPage = 1;
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    document.getElementById('tab-' + tab)?.classList.add('active');
    renderTable();
  }

  function showToast(msg, type = 'info') {
    const t = document.getElementById('toast');
    t.textContent = msg;
    t.className = `toast ${type}`;
    void t.offsetWidth;
    t.classList.add('show');
    setTimeout(() => t.classList.remove('show'), 3000);
  }
</script>
</body>

</html>
